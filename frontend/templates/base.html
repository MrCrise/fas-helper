<!doctype html>
<html lang="ru">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Правовой навигатор ФАС</title>
    
    <!-- Подключение Tailwind CSS (CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Шрифты (IBM Plex Mono) -->
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;600;700&display=swap" rel="stylesheet">
    
    <!-- Библиотеки для Markdown и защиты от XSS -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify/dist/purify.min.js"></script>

    <style>
      /* Определение цветовых переменных для Темной и Светлой темы */
      :root{
        --bg-color: #121212;      /* Основной фон */
        --text-color: #f5f5f5;    /* Основной текст */
        --input-bg: #1e1e1e;      /* Фон полей ввода */
        --input-border: #333;     /* Границы полей */
        --card-bg: #1c1c1c;       /* Фон карточек/сообщений бота */
        --card-border: #333;      /* Границы карточек */
        --bottom-height: 72px;    /* Высота нижнего бара */
        --top-height: 88px;       /* Высота шапки */
      }
      
      body{
        font-family: "IBM Plex Mono", monospace;
        background-color: var(--bg-color);
        color: var(--text-color);
        transition: background-color .25s, color .25s;
      }

      /* Переопределение переменных для светлой темы */
      body.light{
        --bg-color: #f5f5f5;
        --text-color: #111;
        --input-bg: #fff;
        --input-border: #ccc;
        --card-bg: #fff;
        --card-border: #d4d4d4;
      }

      /* Стили Header (полупрозрачное стекло) */
      header.site-header{
        height: var(--top-height);
        backdrop-filter: blur(8px);
        background: rgba(20,20,20,0.5);
        transition: transform .3s ease;
      }
      body.light header.site-header{
        background: rgba(255,255,255,0.7);
      }

      /* Кастомный скроллбар */
      ::-webkit-scrollbar{ width: 8px; height: 8px; }
      ::-webkit-scrollbar-thumb{ background: rgba(128,128,128,.3); border-radius: 4px; }
      ::-webkit-scrollbar-thumb:hover{ background: rgba(128,128,128,.5); }
      ::-webkit-scrollbar-track{ background: transparent; }
    </style>
  </head>

  <body class="min-h-screen flex flex-col">
    <!-- Шапка -->
    <header id="top-bar" class="site-header w-full flex items-center justify-between px-6 border-b border-gray-700/20 sticky top-0 z-50">
      <div>
        <h1 class="text-2xl font-bold tracking-tight">ПРАВОВОЙ НАВИГАТОР ФАС</h1>
        <div class="text-xs opacity-60 mt-1 font-medium">Анализ решений ФАС за минуты</div>
      </div>

      <!-- Кнопка открытия меню -->
      <button id="menu-btn" class="p-2 rounded-md hover:bg-white/10 transition-colors" aria-label="Menu">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
        </svg>
      </button>
    </header>

    <!-- Основной контент (Вставляется из index.html) -->
    <main class="flex-1 relative">
      {% block content %}{% endblock %}
    </main>

    <!-- Сайдбар (Боковое меню) -->
    {% include "sidebar.html" %}

    <script>
      /**
       * Глобальная логика управления интерфейсом:
       * - Открытие/закрытие бокового меню
       * - Переключение светлой/темной темы
       */
      document.addEventListener('DOMContentLoaded', () => {
          const sidebar = document.getElementById('sidebar');
          const overlay = document.getElementById('overlay');
          const menuBtn = document.getElementById('menu-btn');
          const closeSidebarBtn = document.getElementById('close-sidebar-btn');
          const themeToggle = document.getElementById('theme-toggle');
          const body = document.body;

          if (sidebar && overlay && menuBtn && closeSidebarBtn) {
              function openSidebar(){
                sidebar.classList.remove('translate-x-full');
                overlay.classList.remove('hidden');
                setTimeout(() => overlay.classList.remove('opacity-0'), 10);
              }

              function closeSidebar(){
                sidebar.classList.add('translate-x-full');
                overlay.classList.add('opacity-0');
                setTimeout(() => overlay.classList.add('hidden'), 300);
              }

              menuBtn.addEventListener('click', openSidebar);
              closeSidebarBtn.addEventListener('click', closeSidebar);
              overlay.addEventListener('click', closeSidebar);
          }

          if (themeToggle) {
              // Восстановление темы из LocalStorage
              if(localStorage.getItem('theme') === 'light'){
                  body.classList.add('light');
                  themeToggle.checked = true;
              }

              themeToggle.addEventListener('change', () => {
                const isLight = themeToggle.checked;
                body.classList.toggle('light', isLight);
                localStorage.setItem('theme', isLight ? 'light' : 'dark');
              });
          }
      });
    </script>
  </body>
</html>